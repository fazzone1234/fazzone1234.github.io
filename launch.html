<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Launch Scene</title>
<style>
  body { margin: 0; overflow: hidden; background: black; }
  canvas { display: block; }
</style>

<!-- Librerie professionali -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r160/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152/examples/jsm/postprocessing/EffectComposer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152/examples/jsm/postprocessing/RenderPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152/examples/jsm/postprocessing/UnrealBloomPass.js"></script>
</head>
<body>
<script>
let scene, camera, renderer, rocket, composer;
let smokeParticles = [];

init();
animate();

function init() {
  scene = new THREE.Scene();

  // Camera
  camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 5000);
  camera.position.set(0, 5, 15);

  // Renderer
  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Lights
  let light = new THREE.PointLight(0xffffff,2,100);
  light.position.set(0,10,10);
  scene.add(light);
  scene.add(new THREE.AmbientLight(0x555555));

  // Starfield
  let starGeo = new THREE.BufferGeometry();
  let starCount = 10000;
  let positions = new Float32Array(starCount*3);
  for(let i=0;i<starCount*3;i++) positions[i] = (Math.random()-0.5)*2000;
  starGeo.setAttribute('position', new THREE.BufferAttribute(positions,3));
  scene.add(new THREE.Points(starGeo,new THREE.PointsMaterial({color:0xffffff,size:1})));

  // Rocket
  let body = new THREE.Mesh(new THREE.CylinderGeometry(0.4,0.4,3,32), new THREE.MeshStandardMaterial({color:0xffffff}));
  let nose = new THREE.Mesh(new THREE.ConeGeometry(0.4,1,32), new THREE.MeshStandardMaterial({color:0xff0000}));
  nose.position.y = 2;
  rocket = new THREE.Group();
  rocket.add(body);
  rocket.add(nose);
  rocket.position.y = -6;
  scene.add(rocket);

  // Smoke particles
  createSmoke();

  // Composer & Bloom
  composer = new THREE.EffectComposer(renderer);
  composer.addPass(new THREE.RenderPass(scene, camera));
  composer.addPass(new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth,window.innerHeight),1.5,0.4,0.85));

  // Launch
  launchRocket();
}

function createSmoke() {
  let material = new THREE.MeshLambertMaterial({color:0xffffff, transparent:true, opacity:0.4});
  for(let i=0;i<60;i++){
    let p = new THREE.Mesh(new THREE.PlaneGeometry(1,1), material);
    p.position.set((Math.random()-0.5)*0.5,-6+(Math.random()*0.2),(Math.random()-0.5)*0.5);
    scene.add(p);
    smokeParticles.push(p);
  }
}

function launchRocket() {
  // Flash
  const flash = document.createElement('div');
  Object.assign(flash.style,{
    position:'absolute', top:'0', left:'0', width:'100%', height:'100%',
    background:'white', opacity:'0', pointerEvents:'none'
  });
  document.body.appendChild(flash);
  gsap.to(flash,{opacity:1,duration:0.2});
  gsap.to(flash,{opacity:0,duration:1,delay:0.2});

  // Camera shake
  gsap.to(camera.position,{x:"+=0.2",yoyo:true,repeat:10,duration:0.05,ease:"power1.inOut"});

  // Rocket lift-off
  gsap.to(rocket.position,{y:150,duration:12,ease:"power4.in"});

  // Smoke animation
  smokeParticles.forEach(p=>{
    gsap.to(p.position,{
      y:"+="+(Math.random()*150),
      x:"+="+(Math.random()-0.5)*10,
      z:"+="+(Math.random()-0.5)*10,
      opacity:0,
      duration:12
    });
  });

  // Warp particles
  createWarpParticles();

  // Warp effect + redirect
  setTimeout(()=>{
    let warpDiv = document.createElement('div');
    Object.assign(warpDiv.style,{
      position:'absolute', top:'0', left:'0', width:'100%', height:'100%',
      background:'radial-gradient(circle,#00ffff,#000000)', opacity:'0'
    });
    document.body.appendChild(warpDiv);
    gsap.to(warpDiv,{opacity:1,duration:2});
    setTimeout(()=>{ window.location.href='home.html'; },2500);
  },11000);
}

function createWarpParticles(){
  let particleCount = 200;
  let geometry = new THREE.BufferGeometry();
  let positions = [];
  for(let i=0;i<particleCount;i++){
    positions.push((Math.random()-0.5)*1,-6,(Math.random()-0.5)*1);
  }
  geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions,3));
  let points = new THREE.Points(geometry,new THREE.PointsMaterial({color:0xffaa00,size:0.2}));
  scene.add(points);
  gsap.to(points.position,{y:150,duration:12,ease:"power4.in"});
}

function animate(){
  requestAnimationFrame(animate);
  composer.render();
  smokeParticles.forEach(p=>{ p.rotation.z += 0.01; });
}
</script>
</body>
</html>
